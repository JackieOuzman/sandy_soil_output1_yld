---
title: "Paddock Report"
author: "Jackie Ouzman"
date: "2026-02-08"
output: 
  pdf_document:
    latex_engine: xelatex
header-includes:
  - \usepackage{tcolorbox}
  - \usepackage{xcolor}
  - \definecolor{deepteal}{RGB}{0, 137, 123}
Paddock: TBC
Site: Wharminda
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r load_libary, include=FALSE}
library(ggplot2)
library(readxl)
library(tidyverse)
library(lubridate)
library(data.table)
library(stringr)
library(sf)
library(kableExtra)
```



```{r site, include=FALSE}
site_report <- "Crystal Brook"

dir <- "//fs1-cbr.nexus.csiro.au/{af-sandysoils-ii}"
site_number <- "6.Crystal_Brook_Randals"
site_name <- "Crystal_Brook_Randals"
headDir <- paste0(dir, "/work/Output-1/", site_number)



analysis.yr <- "25"

metadata_path <- paste0(dir,"/work/Output-1/0.Site-info/")
metadata_file_name <- "names of treatments per site 2025 metadata and other info.xlsx"



file_path_details_1 <- readxl::read_excel(
  paste0(metadata_path,metadata_file_name),
  sheet = "file location etc") %>% 
  filter(Site == site_number)   
  #filter(variable == paste0(analysis.type, " data file" ))

```


### Rainfall and Trial data

```{r list of sites, echo=FALSE}

list_of_sites <- data.frame(
    Name = c("Karoonda", "Wharminda", "Copeville", "Walpeup" , "Bute", "Balaklava", "Annuello", "Crystal Brook", "Wynarka"),
    Number = c("25006", "18113", "25003", "76065", "21012", "21002", "76000", "21016", "25006"),
    Latitude = c("-35.09", "-33.97", "-34.80", "-35.14",  "-33.86", "-34.14", "-34.85",   "-33.35", "-35.09"),
    Longitude = c("139.90", "136.25", "139.85", "142.02", "138.01", "138.42", "142.78", "138.21", "139.90"),
    State = c("SA", "SA", "SA", "VIC","SA", "SA", "VIC", "SA", "SA")
    )

knitr::kable(list_of_sites %>% filter(Name == site_report),
             caption = "Site Information",
             booktabs = TRUE)

 
``` 



```{r imprort daily met season type, echo=FALSE}

file_path_input_data<-file.path("H:","Output-1", "0.Site-info", "Climate", "Decile_tables")

met_station_number <- list_of_sites %>% 
  filter(Name == site_report) %>% 
  pull(Number)  # Use pull() to get the value, not a data frame

# List all CSV files
list_of_files <- list.files(path = file_path_input_data, pattern = ".csv")

# Find the file containing the met station number
file_to_read <- list_of_files[grep(paste0("Daily_met_file_season types_", met_station_number), list_of_files)]

file_to_read2 <- list_of_files[grep(paste0("Year_with_Deciles_", met_station_number), list_of_files)]

# Read the file
decile_data <- read.csv(file.path(file_path_input_data, file_to_read))
# Read the file
years_with_decile <- read.csv(file.path(file_path_input_data, file_to_read2))


```






```{r rain stats, echo=FALSE}
# Calculate rainfall statistics
annual_rainfall <- decile_data %>%
  group_by(year) %>%
  summarise(annual_rain = sum(Rain, na.rm = TRUE)) %>%
  summarise(avg_annual_rainfall = mean(annual_rain, na.rm = TRUE)) %>%
  pull(avg_annual_rainfall)

summer_rainfall <- decile_data %>%
  filter(season_summer == "summer") %>%
  group_by(year) %>%
  summarise(summer_rain = sum(Rain, na.rm = TRUE)) %>%
  summarise(avg_summer_rainfall = mean(summer_rain, na.rm = TRUE)) %>%
  pull(avg_summer_rainfall)

gs_rainfall <- decile_data %>%
  filter(season_GS == "gs") %>%
  group_by(year) %>%
  summarise(gs_rain = sum(Rain, na.rm = TRUE)) %>%
  summarise(avg_gs_rainfall = mean(gs_rain, na.rm = TRUE)) %>%
  pull(avg_gs_rainfall)

# Create a summary table
rainfall_summary <- data.frame(
  `Rainfall Metric` = c("Met Station Number",
                        "Station Name",
                        "Average Annual Rainfall (mm)", 
                        "Average Summer Rainfall (1 Nov - 1 Apr) (mm)", 
                        "Average GS Rainfall (1 Apr - 15 Oct) (mm)"),
  Value = c(unique(decile_data$Number),
            unique(decile_data$Name),
            round(annual_rainfall, 1),
            round(summer_rainfall, 1),
            round(gs_rainfall, 1)),
  check.names = FALSE
)


# Display with
knitr::kable(rainfall_summary,
             caption = "Rainfall Summary Statistics",
             booktabs = TRUE,
             col.names = c("", ""))
```



```{r metadata , echo=FALSE}
Sowing_metadata <- readxl::read_excel(
  paste0(metadata_path,metadata_file_name),
  sheet = "seasons") %>% 
  filter(Site == site_number) 

Sowing_metadata <- left_join(Sowing_metadata, years_with_decile, join_by(Year == year))


# Select and format relevant columns in the correct order
sowing_table <- Sowing_metadata %>%
  select(Year, Crop, Variety, `Sowing date`, `Harvest date`, 
         gs_sum_rain, summer_sum_rain, gs_decile, summer_decile) %>%
  mutate(
    `Sowing date` = format(`Sowing date`, "%d %b %Y"),
    `Harvest date` = as.character(`Harvest date`)  # Convert logical NA to character
  ) %>%
  rename(
    `GS Rainfall (mm)` = gs_sum_rain,
    `Summer Rainfall (mm)` = summer_sum_rain,
    `GS Decile` = gs_decile,
    `Summer Decile` = summer_decile
  )

# Create caption from unique values
gs_period <- unique(Sowing_metadata$GS_period)[1]
summer_period <- unique(Sowing_metadata$summer_period)[1]
years_included <- unique(Sowing_metadata$Years_included)[1]

caption_text <- paste0("Crop Sowing and Rainfall Summary<br>",
                       "GS Period: ", gs_period, " | ",
                       "Summer Period: ", summer_period, " | ",
                       "Years Included: ", years_included)

# Create caption from unique values
gs_period <- unique(Sowing_metadata$GS_period)[1]
summer_period <- unique(Sowing_metadata$summer_period)[1]
years_included <- unique(Sowing_metadata$Years_included)[1]




sowing_table1 <- sowing_table %>%
  select("Year" , "Crop"  , "Variety", "Sowing date"  , "Harvest date")
rain_table2 <- sowing_table %>%
  select("Year" , "GS Rainfall (mm)"  , "Summer Rainfall (mm)", "GS Decile"   ,"Summer Decile" )


```

```{r rain table 2, echo=FALSE, message=FALSE, warning=FALSE}

caption_text <- paste0("Trial Years with Rainfall Summary. \\\\ ",
                       "GS Period: ", gs_period, " \\\\ ",
                       "Summer Period: ", summer_period, " \\\\ ",
                       "Years Included: ", years_included)
knitr::kable(rain_table2 %>% mutate(across(everything(), ~replace_na(as.character(.), ""))),
             caption = caption_text,
             booktabs = TRUE,
             longtable = FALSE) %>%
  kable_styling(latex_options = c("hold_position", "scale_down")) %>%
  column_spec(2, width = "3cm") %>%
  column_spec(3, width = "3cm")


```

```{r sowing table, echo=FALSE, message=FALSE, warning=FALSE}


knitr::kable(sowing_table1 %>% mutate(across(everything(), ~replace_na(as.character(.), ""))),
             caption = "Trial Years Sowing Summary",
             booktabs = TRUE,
             longtable = FALSE) %>%
  kable_styling(latex_options = c("hold_position", "scale_down")) %>%
  column_spec(2, width = "3cm") %>%
  column_spec(3, width = "3cm")


```

### Soil constraints at site

```{r Soil constraints, include=FALSE}
#Need some information here….

path_constraints_description<- paste0(dir,"/work/multi-site analysis soil characteristics/Sandy Soils II-site descriptors.xlsx")

constraints_description <- readxl::read_excel(path_constraints_description, sheet = "Constraints Description") %>%
  dplyr::filter(Site == site_number) %>%
  dplyr::select("Site",
                "Repellence",
                "Soil Strength",
                "Acidity",
                "Fertility",
                "Carbonate",
                "Notes") %>%
  mutate(across(everything(), ~replace_na(as.character(.), "")))





```

```{r Soil constraints table, echo=FALSE}
# Display with
knitr::kable(constraints_description,
             caption = "Constraints description",
             booktabs = TRUE)
```
### Management zones:

#### Layers used to define management zone


**(No images Please confirm this)**





```{r input for managmnet zone, echo=FALSE, warning=FALSE, fig.align='center', out.width='50%'}
 

# knitr::include_graphics(paste0(site_name, "_images/covs_1_16.png"))
# knitr::include_graphics(paste0(site_name, "_images/covs_17_32.png"))


# knitr::include_graphics(paste0(site_name, "_images/Gums_0-10_pH_Veris_uncalibrated_v2.png"))
# knitr::include_graphics(paste0(site_name, "_images/Gums_elevation.png"))
# knitr::include_graphics(paste0(site_name, "_images/Gums_em.png"))
# knitr::include_graphics(paste0(site_name, "_images/Gums_gamma.png"))
# knitr::include_graphics(paste0(site_name, "_images/Gums_satellite.png"))
# knitr::include_graphics(paste0(site_name, "_images/Gums_sentinel_ndvi.png"))


# knitr::include_graphics(c(
#   paste0(headDir, "/3.Covariates/7.Plots/No Images.png"),
#   paste0(headDir, "/3.Covariates/7.Plots/No Images.png")
# ))
```

#### Map of management zone.


```{r map of managmnet zone, echo=FALSE, warning=FALSE, fig.align='center', out.width='60%'}
 

knitr::include_graphics(paste0(site_name, "_images/Zone Jackie.png"))

# knitr::include_graphics(c(
#   paste0(headDir, "/3.Covariates/6.Clusters_Zones/FINAL/Zone Jackie.png")
# ))
```


```{r stats managmnet zone, message=FALSE, warning=FALSE, include=FALSE}
file_path_zone <- readxl::read_excel(
  paste0(metadata_path,metadata_file_name),
  sheet = "file location etc") %>% 
  filter(Site == site_number)  %>%  
  filter(variable == "location of zone shp" ) %>% 
  pull("file path")
zones <- st_read(paste0(headDir,file_path_zone))

zones_table <- zones %>%
  st_drop_geometry() %>%  # Remove geometry column
  mutate(
    #Zone = as.character(gridcode), #
    Zone = as.character(cluster), #
    #Zone = as.character(fcl_mdl), #
    #Zone = as.character(cluster3), #
    #Zone = as.character(fcl_mdl), #
    Area_ha = round(POLY_AREA, 0),
    Percent = round(POLY_AREA / sum(POLY_AREA) * 100, 1)
  ) %>%
  select(Zone, Area_ha, Percent) %>%
  bind_rows(
    data.frame(
      Zone = "Total",
      Area_ha = sum(.$Area_ha),
      Percent = 100.0  # Changed from Percen to Percent and set to 100
    )
  )

```

```{r stats managmnet zone table, echo=FALSE, message=FALSE, warning=FALSE}
# Display as DT table
knitr::kable(zones_table,
             col.names = c('Zone', 'Area (ha)', 'Percentage (%)'),
             booktabs = TRUE)
```

#### Details strips.

**Date of amelioration:**
**Additional information on strips:**

```{r map of strip , echo=FALSE, warning=FALSE,fig.align='center', out.width='60%'}
 

knitr::include_graphics(paste0(site_name, "_images/Strips Jackie.png"))


```


```{r stats strips, message=FALSE, warning=FALSE, include=FALSE}
file_path_strip <- readxl::read_excel(
  paste0(metadata_path,metadata_file_name),
  sheet = "file location etc") %>% 
  filter(Site == site_number)  %>%  
  filter(variable == "trial.plan" ) %>% 
  pull("file path")



zones <- st_read(paste0(headDir,file_path_zone))
strip <- st_read(paste0(headDir,file_path_strip))


# Calculate dimensions for each polygon
strip <- strip %>%
  rowwise() %>%
  mutate(
    bb = list(st_bbox(geometry)),
    x_dist = bb$xmax - bb$xmin,
    y_dist = bb$ymax - bb$ymin,
    Length_m = round(max(x_dist, y_dist), 0),
    Width_m = round(min(x_dist, y_dist), 0),
    Area_ha = round(as.numeric(st_area(geometry)) / 10000, 2)
  ) %>%
  ungroup() %>%
  select(-bb, -x_dist, -y_dist)

strip_dims <- strip %>%
  st_drop_geometry() %>%
  filter(treat_desc != "Buffer") %>%
  select(Length_m, Width_m) %>%
  slice(1)  # Get first row (they're all the same)
strip_length <- strip_dims$Length_m
strip_width <- strip_dims$Width_m

```



```{r stats strips with zone, message=FALSE, warning=FALSE, include=FALSE}

# Join - attributes from zones added to strip based on overlap
joined <- st_intersection(strip, zones)

# Remove old area columns
joined <- joined %>% select(-POLY_AREA, -Area_ha)

# Recalculate area for the NEW intersected polygons
joined <- joined %>%
  mutate(Area_ha = round(as.numeric(st_area(geometry)) / 10000, 2))



# Create summary table
# Create summary table
summary_table <- joined %>%
  rename(Zone = cluster) %>% 
  #rename(Zone = cluster3) %>% 
  #rename(Zone = fcl_mdl) %>% 
  #rename(Zone = gridcode) %>% 
  st_drop_geometry() %>%
  filter(treat_desc != "Outside Control" & treat_desc != "Buffer") %>%
  select(treat_desc, Zone, Area_ha) %>%
  mutate(Area_ha = round(Area_ha, 2)) %>%
  pivot_wider(names_from = Zone, 
              values_from = Area_ha,
              names_prefix = "Zone ") %>%
  mutate(Total = rowSums(across(starts_with("Zone")), na.rm = TRUE))



## Note at this site there was no strips with zone 3
 # summary_table <- summary_table %>%
 #  add_column(`Zone 3` = NA, .after = "Zone 2")

```



```{r stats strips with zones, echo=FALSE, message=FALSE, warning=FALSE}
# Create caption with strip dimensions
caption <- paste0("Strip dimensions: ", strip_length, " m × ", strip_width, " m")

# knitr::kable(summary_table %>% mutate(across(everything(), ~replace_na(as.character(.), ""))),
#              caption = caption,
#              col.names = c('Treatment', 'Zone 1', 'Zone 2', 'Zone 3',  'Total (ha)'),
#              booktabs = TRUE)

knitr::kable(summary_table %>% mutate(across(everything(), ~replace_na(as.character(.), ""))),
             caption = caption,
             col.names = c('Treatment', 'Zone 1', 'Zone 2', 'Zone 3','Total (ha)'),
             booktabs = TRUE)
```

#### Details Point sampling

```{r point sampling, message=FALSE, warning=FALSE, include=FALSE}
Point_sampling <- readxl::read_excel(
  paste0(metadata_path, metadata_file_name),
  sheet = "file location etc") %>% 
  filter(Site == site_number) %>%
  filter(grepl("date collected", variable, ignore.case = TRUE)) %>%
  mutate(variable = str_remove(variable, regex(" date collected", ignore_case = TRUE))) %>%
  rename(Date_collected = `other details`,
         analysis_type = variable) %>%
  select(Site , Date_collected, analysis_type) %>% 
  mutate(Date_collected = as.Date(as.numeric(Date_collected), origin = "1899-12-30"))

#names(Point_sampling)
point_table <- Point_sampling %>%
  select(analysis_type, Date_collected)
```

```{r point sampling table, echo=FALSE, message=FALSE, warning=FALSE}
# Create caption with site number
caption <- paste0("Point Sampling - Site: ", Point_sampling$Site[1])

knitr::kable(point_table,
             caption = caption,
             col.names = c('Analysis Type', 'Date Collected'),
             booktabs = TRUE)
```

```{r map of sampling location 2025 , echo=FALSE, warning=FALSE, fig.align='center', out.width='60%'}
 

knitr::include_graphics(paste0(site_name, "_images/sampling location jackie.png"))


#"H:/Output-1/3.Wynarka_Mervs_West/7.In_Season_data/25/sampling location jackie.png"
```

#### Results Point sampling

##### Strip 




**- Note Randal was resown, expect for one strip, chicken litter.**

**- Maturity samples were taken along the original row via linear meters but (4*50cm)**

**- Randal - Establish data was collect in both rows and inter row, all data used.**

**- Randal - I cannot locate biomass at flowering results.**

Treatment effects were evaluated by comparing each treatment to the control using independent samples t-tests. 

A separate t-test was conducted for each treatment, with the control group as the reference in each comparison. To account for the increased risk of Type I error associated with multiple comparisons, p-values were adjusted using the Bonferroni correction. Treatments were considered statistically significantly different from the control at an adjusted p-value threshold of p ≤ 0.10. 

Treatments that were not significantly different from the control are denoted with the letter "a", while treatments that were significantly different from the control are denoted with the letter "b". All statistical analyses were conducted in R (version 4.5.1) using the broom and dplyr packages.





```{r Stats pt sampling results strips1, echo=FALSE, fig.show='hold', warning=FALSE, out.width="50%"}
 

knitr::include_graphics(
  c(
    paste0(site_name, "_images/plots/", "Establishment", "_strip_mean_T_test_plot.png"),
    #paste0(site_name, "_images/plots/", "Establishment CV", "_strip_mean_T_test_plot.png"),
    paste0(site_name, "_images/plots/", "Biomass_flowering", "_strip_mean_T_test_plot.png"),
    
    paste0(site_name, "_images/plots/", "Biomass_maturity", "_strip_mean_T_test_plot.png"),
    paste0(site_name, "_images/plots/", "Grain yield", "_strip_mean_T_test_plot.png"),
    #paste0(site_name, "_images/plots/", "Protein", "_strip_mean_T_test_plot.png"),
    paste0(site_name, "_images/plots/", "Harvest index", "_strip_mean_T_test_plot.png")#,
    #paste0(site_name, "_images/plots/", "Thousand grain weight", #"_strip_mean_T_test_plot.png")
    
  )
)

## NB Results are here   
## "\\fs1-cbr.nexus.csiro.au\{af-sandysoils-ii}\work\Output-1\site\10.Analysis\25\Processing_J#ackie"
## NB Analysis script is here
#"\\pentagon-gw\C$\Users\ouz001\working_from_home_post_Sep2022\sandy_soil_output1_yld\Point_da#ta"

# I have copied the plots over to the local drive so R markdown can access them.
```




##### Strip by zone

Sample size is very low and results not plotted.





#### Results Yield data (off header).









There are many different ways to analyse yield monitor data. Yield data is often noisy, so thinning, cleaning, and trimming are usually recommended. Yield data is also frequently kriged to interpolate missing values and generate a map.

Strip trials add complexity to this process. Long, unreplicated strips within a paddock are difficult to krige. In some trials, low or zero yield values may be real, but standard cleaning and trimming methods may remove these values. Retaining zero values add complexity to statical analysis.

The workflow below represents just one approach for analysing strip trial yield data collected from a yield monitor. Further refinement and testing are needed to optimise the method.
Current Workflow

Harvest data from the yield monitor (processed in QGIS using Christina Tools, an extension of PAT):

1.	Data projected.
2.	Data thinned to 1m spacing.
3.	No cleaning or trimming applied.
4.	Yield not adjusted for moisture.
5.	Outliers removed by visual inspection.
6.	X and Y coordinates assigned to the shapefile.
7.	Data exported as a shapefile and CSV.




```{r map of yld data rawish 2025 , echo=FALSE, warning=FALSE, fig.align='center', out.width='60%'}
 

knitr::include_graphics(paste0(site_name, "_images/Yield_data_jackie raw_data.png"))
#knitr::include_graphics("Wynarka_Mervs_West_images/Yield data  jackie raw data.png")
```

Strip ladder polygons  (in QGIS using Christina Tools):

8.	Strip treatments and control areas (excluding buffers) selected.
9.	Polygon ladders generated (10m length × strip width).
10.	Polygon, line, and point layers exported as shapefiles.

```{r map of yld data polygons 2025 , echo=FALSE, warning=FALSE, fig.align='center', out.width='60%'}
 

knitr::include_graphics(paste0(site_name, "_images/Yield_data_jackie_ladders.png"))
```

Analysis in R:

11.	Target yield column selected from yield dataset.
12.	Yield data joined and clipped to the ladder polygons.
13.	Yield data joined to management zones.
14.	Yield values within each ladder polygon averaged to create one yield value per ladder.
15.	Centroid of each polygon ladder created
16.	These averaged values are used for further analysis and plotting.



```{r map of yld along strips , echo=FALSE, warning=FALSE, fig.align='center', out.width='100%'}
 

knitr::include_graphics(paste0(site_name, "_images/Yld_monitor_strip_distance.png"))
```


# Analysis by strips
A separate t-test was conducted for each treatment, with the control group as the reference in each comparison. To account for the increased risk of Type I error associated with multiple comparisons, p-values were adjusted using the Bonferroni correction. Treatments were considered statistically significantly different from the control at an adjusted p-value threshold of p ≤ 0.10. 


```{r Stats yld harvest data strips, echo=FALSE, warning=FALSE, fig.align='center', out.width='100%'}
 

knitr::include_graphics(
  c(paste0(site_name, "_images/plots/", "Yld_monitor_strip_plot", ".png"))
)

# ## NB Results are here   
# ## "\\fs1-cbr.nexus.csiro.au\{af-sandysoils-ii}\work\Output-1\site\10.Analysis\25\Harvest\
# ## NB Analysis script is here
# #"\\pentagon-gw\C$\Users\ouz001\working_from_home_post_Sep2022\sandy_soil_output1_yld\Yield_#Mointor_data"
# 
# # I have copied the plots over to the local drive so R markdown can access them.

```

# Analysis by strips and zones

Treatment effects were evaluated by comparing each treatment to the control using independent samples t-tests. This analysis was conducted separately within each management zone, such that a separate set of t-tests was performed for each zone, with each treatment compared to the control observations within that same zone. Note that while four management zones were defined across the broader field, only three zones (1, 2, and 4) were present within the trial area and were therefore included in the analysis. To account for the increased risk of Type I error associated with multiple comparisons, p-values were adjusted using the Bonferroni correction. Treatments were considered statistically significantly different from the control at an adjusted p-value threshold of p ≤ 0.10. Treatments that were not significantly different from the control are denoted with the letter "a", while treatments that were significantly different from the control are denoted with the letter "b". All statistical analyses were conducted in R (version 4.5.1) using the broom and dplyr packages.





```{r Stats yld harvest data, echo=FALSE, warning=FALSE, fig.align='center', out.width='100%'}
 

knitr::include_graphics(
  c(paste0(site_name, "_images/plots/", "Yld_monitor_strip_zone_plot", ".png"))
)

# ## NB Results are here   
# ## "\\fs1-cbr.nexus.csiro.au\{af-sandysoils-ii}\work\Output-1\site\10.Analysis\25\Harvest\
# ## NB Analysis script is here
# #"\\pentagon-gw\C$\Users\ouz001\working_from_home_post_Sep2022\sandy_soil_output1_yld\Yield_#Mointor_data"
# 
# # I have copied the plots over to the local drive so R markdown can access them.

```

